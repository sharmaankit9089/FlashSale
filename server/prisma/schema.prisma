generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  CANCELLED
  EXPIRED
}

enum InventoryEventType {
  STOCK_ADDED
  HOLD_CREATED
  HOLD_RELEASED
  ORDER_CONFIRMED
}

model Product {
  id            Int              @id @default(autoincrement())
  name          String
  description   String
  price         Int
  totalStock    Int              @map("total_stock")
  saleStartsAt  DateTime         @map("sale_starts_at")
  saleEndsAt    DateTime         @map("sale_ends_at")
  createdAt     DateTime         @default(now()) @map("created_at")

  orders        Order[]
  events        InventoryEvent[]

  @@map("products")
}

model Order {
  id            Int         @id @default(autoincrement())
  productId     Int         @map("product_id")
  customerEmail String      @map("customer_email")
  quantity      Int
  status        OrderStatus
  holdExpiresAt DateTime    @map("hold_expires_at")
  createdAt     DateTime    @default(now()) @map("created_at")

  product       Product     @relation(fields: [productId], references: [id])

  @@map("orders")
}

model InventoryEvent {
  id         Int                  @id @default(autoincrement())
  productId  Int                  @map("product_id")
  type       InventoryEventType
  delta      Int
  metadata   Json?
  createdAt  DateTime             @default(now()) @map("created_at")

  product    Product              @relation(fields: [productId], references: [id])

  @@map("inventory_events")
}
